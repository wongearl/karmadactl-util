package common

import (
	"context"
	"testing"

	v1 "k8s.io/api/core/v1"
	metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"
	"k8s.io/apimachinery/pkg/runtime"
	testclient "k8s.io/client-go/kubernetes/fake"
)

var (
	// Scheme contains all types of custom clientset and kubernetes client-go clientset
	Scheme = runtime.NewScheme()
)

func TestWriteKubeconfig(t *testing.T) {

	byteSline := []byte("YXBpVmVyc2lvbjogdjEKa2luZDogQ29uZmlnCmNsdXN0ZXJzOgogIC0gY2x1c3RlcjoKICAgICAgY2VydGlmaWNhdGUtYXV0aG9yaXR5LWRhdGE6IExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVJ0VkVORFFXOUhaMEYzU1VKQlowbFZSbU12VVRFck9HRXZWMGhQU3l0QmVtOTBkRVZwVW5NNFZWUm5kMFJSV1VwTGIxcEphSFpqVGtGUlJVd0tRbEZCZDFoRVJVeE5RV3RIUVRGVlJVSm9UVU5sU0dkNFEycEJTVUpuVGxaQ1FXZE5RVmhuZUVOcVFVbENaMDVXUWtGalRVRllaM2hEYWtGSlFtZE9WZ3BDUVc5TlFWaG5lRU5xUVVsQ1owNVdRa0Z6VFVGWVozaERla0ZLUW1kT1ZrSkJUVTFCYlU1b1RWSkJkMFJuV1VwTGIxcEphSFpqVGtGUmEwSkdaMFkwQ2sxQ05GaEVWRWw2VFVSVmVVNUVRVEpOZWtsNVRteHZXRVJVU1RCTlJGVjVUWHBCTWsxNlNYbE9iRzkzV0VSRlRFMUJhMGRCTVZWRlFtaE5RMlZJWjNnS1EycEJTVUpuVGxaQ1FXZE5RVmhuZUVOcVFVbENaMDVXUWtGalRVRllaM2hEYWtGSlFtZE9Wa0pCYjAxQldHZDRRMnBCU1VKblRsWkNRWE5OUVZobmVBcERla0ZLUW1kT1ZrSkJUVTFCYlU1b1RWSkJkMFJuV1VwTGIxcEphSFpqVGtGUmEwSkdaMFkwVFVsSlFrbHFRVTVDWjJ0eGFHdHBSemwzTUVKQlVVVkdDa0ZCVDBOQlVUaEJUVWxKUWtOblMwTkJVVVZCZUc1b2JuRXpSM28zVkhWM1dGQnFTVFZMWW1KMFUyNXRPQ3MyTVhWclpHZGpkalJXVEUxdGFXVjBOa3dLYjFwSlF6WjBXVFZOZGtkRE5rcFNTakZHTVhKR1JWb3JOa0owVVZWaVdVeFJVWFl2VUhWVVYzRnFXakpYVkVGTFZGWjVkRkpDZFVGeU0wdDBiVU5MTmdwaWRYQnNjbkF2Y1RabmFIVk5LMXBuYmpVNE0wZFdSMmROZEhCdFVsSkJPV1p6WW1kTk5rSnFRV1kxZVZaNFRuWnFWbVJVZUZaRGRVUnJPV1IyVEhWTENrTXpNaTlVVFZOSlVVTlVUWFZQYjNSU01rSXJhRUpIU2tKaVMyeDZhRmhEUlhoSFprdHBUM2hQTW01MlQzcEVOMnhoVTBwR1FUY3dTVGRpTjNoUU5YUUtURlE1VDNKdVZXTXdPWFU1WVZWa01teFZWekpvUlhScWJYWmlWbGx6V1NzeFMwMW1hREEzY21KWFEzaFZOMEZ2TjB4amF6Y3hTVmRwYnpoNlprbERUUXBGTUV3MFUzZ3habU4zY0cxTmRsVnpOWEIyVmtJMVQzQndWMjlTVm5VcmVFeExVVE5pYzBsbmFGRkpSRUZSUVVKdk1VMTNWVlJCWkVKblRsWklVVFJGQ2tablVWVnZhbFZ6YzJGV1NVOTZVRUpyVkRSSlVtc3dhVE12UlcxQ1J6UjNTSGRaUkZaU01HcENRbWQzUm05QlZXOXFWWE56WVZaSlQzcFFRbXRVTkVrS1Vtc3dhVE12UlcxQ1J6UjNSSGRaUkZaU01GUkJVVWd2UWtGVmQwRjNSVUl2ZWtGT1FtZHJjV2hyYVVjNWR6QkNRVkZ6UmtGQlQwTkJVVVZCUTBvemRncGlRa1ZtYlhJM1QxQkRLMHhLTTJSaFRqSkJNVFpFWTBaUlpubzRWbEpSVlRKM09FRkxSa2xGTVVaclIzTlllaXRDYkVkdk5qbFdUalZVVjJNd0sweEJDazB6ZDJWS1ZrdGplazFUVlhsRFVFaEliMUp5SzJ0SlNERlpUM0YxV2xoM1ptdHJSbnBKVnpCWlp6RmxVM0ZrWVZobVdXUXJNbU5tTmtKVVZGRkRibmdLWlhsb2RUVk9OVTVoVURkNk5reEJOR054ZFZCeGFHbzJObUZ4VnpRd2MydG9OMVprZVRWa1dFZGtWa1pDVW5GVFJFcHBXWEJzVkM4ck0wVkNkMWxEWXdwcGVVRmhUV2w1T0ZKV2FEaHBabXg0TUdodWFtYzJSWFIzYVN0WlNrd3lUVkpTV2xocVMxQTNWakpXTTBKTVZFNTZObWd5VTA5blJsRm5lRlZhVFRBMENtc3JSR2wzWjJRMWEzQXpabnBsVW01UFJXbDZVRVpwTldrMmEwVlNNRVkyWmxsMk4zcG5XbTlZVUN0UlMxZHlOemgxU2pGYWJISTNkUzlVUVcwMVVrUUtWM05ZY0VoMlFXSnFTbXhEUW01VVFqRjNQVDBLTFMwdExTMUZUa1FnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUW89CiAgICAgIGluc2VjdXJlLXNraXAtdGxzLXZlcmlmeTogZmFsc2UKICAgICAgc2VydmVyOiBodHRwczovL2thcm1hZGEtYXBpc2VydmVyLmthcm1hZGEtc3lzdGVtLnN2Yy5jbHVzdGVyLmxvY2FsOjU0NDMKICAgIG5hbWU6IGthcm1hZGEtYXBpc2VydmVyCnVzZXJzOgogIC0gdXNlcjoKICAgICAgY2xpZW50LWNlcnRpZmljYXRlLWRhdGE6IExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVZQVkVORFFYbEhaMEYzU1VKQlowbFZTMnR6Vld0NE5IaGxLMFZ6ZHpST1JtbHVaMUkwZEM5bVQxUkJkMFJSV1VwTGIxcEphSFpqVGtGUlJVd0tRbEZCZDFoRVJVeE5RV3RIUVRGVlJVSm9UVU5sU0dkNFEycEJTVUpuVGxaQ1FXZE5RVmhuZUVOcVFVbENaMDVXUWtGalRVRllaM2hEYWtGSlFtZE9WZ3BDUVc5TlFWaG5lRU5xUVVsQ1owNVdRa0Z6VFVGWVozaERla0ZLUW1kT1ZrSkJUVTFCYlU1b1RWSkJkMFJuV1VwTGIxcEphSFpqVGtGUmEwSkdaMFkwQ2sxRFFWaEVWRWw2VFVSVmVVNUVRVEpOYW1OM1RVWnZXVVI2U1hoTmFrMTNUa1JOZDAxRVdYbE9la0YzVjJwQmQwMVNZM2RHVVZsRVZsRlJTMFYzTlhvS1pWaE9NRnBYTURaaVYwWjZaRWRXZVdONlJWWk5RazFIUVRGVlJVRjRUVTFqTTJ4NlpFZFdkRTl0Um10aVYyeDFUVWxKUWtscVFVNUNaMnR4YUd0cFJ3bzVkekJDUVZGRlJrRkJUME5CVVRoQlRVbEpRa05uUzBOQlVVVkJkQzg1S3pGS05WaEZVMnQwT0ZZeE5IcGhla1ZLZEhod1VrRk1aVmQ2ZWsxcE5WcFdDa3Q1VldoVVlXcFpWa2x1VUhvekt6VkVUV2g0YzFwWlNrZFZlbGd2TTFGcEwxazJWblJPVVRWMU9EQnNXRVo1VFd4dVQwbFpWMlJJVUZOdlprcFFZV01LTTJSbmJHcDRSelJtWkZkcmJrMHZjVEpsUzBWdlZHbGtaR294ZDB0b2QxZGtTbTF6UVhSSmQwRjJaemhDYzNWVVdrVnNWMkpXTlVRNU1saDVWMGxGWWdwNGRWRmlXR2xRYkc1YVJDdFFOMUJ1Tm1sRE9FMW5jRmhhUlZsSFUwSk5jWEYzZEZVNWRuUXZLMHh5YzJZM1VsWnVkR2czTVRCVE4yMUZNbUpNTTBWaUNqRnZNV0ZETVVoSWJWZ3hSVGhTVTJnMmFYWnlTa2h2YW5sMlFUSTVabk5YTVV4VWVTOUpURk42T0d0MFVtRXZVRWhuYkRsWkwweDJTbXBUYTJoeWRsZ0tOQzkyUkVaeU1FUnBZWHBvT1VOeEsxQnFTRWgxTm1rdlltRnJTRzEwY0c0eFFqUkNSM1ZIVGxabE9IWk9VbGQyV0ZGSlJFRlJRVUp2TkVsQ1IzcERRd3BCVW1OM1JHZFpSRlpTTUZCQlVVZ3ZRa0ZSUkVGblYyZE5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMURRbWRuY2tKblJVWkNVV05FQ2tGVVFVMUNaMDVXU0ZKTlFrRm1PRVZCYWtGQlRVSXdSMEV4VldSRVoxRlhRa0pSTmtabldpODFWazQyT0RKYVZqUXdkbmw0VWtoWlFUWm9WV1JFUVdZS1FtZE9Wa2hUVFVWSFJFRlhaMEpUYVU1VGVYaHdWV2MzVFRoSFVsQm5hRWRVVTB4bU9GTlpSV0pxUTBKc2QxbEVWbEl3VWtKSlIxQk5TVWROWjJoYWNncGtWMHBzWTIwMWJHUkhWbnBNYlZKc1dtMUdNV0pJVVhWak0xcHFaMmxqY1V4dFZqQlpNbEYxWVRKR2VXSlhSbXRaVXpGNlpWaE9NRnBYTUhWak0xcHFDa3h0VG5Oa1dFNHdXbGhKZFdKSE9XcFpWM2xEU1dsdmRXRXlSbmxpVjBacldWTXhlbVZZVGpCYVZ6QjFZek5hYWt4dFRuTmtXRTR3V2xoSmRXSkhPV29LV1ZkNVEwWkRiM1ZoTWtaNVlsZEdhMWxUTVhwbFdFNHdXbGN3ZFdNeldtcG5aMnh6WWpKT2FHSkhhSFpqTTFOSVFrZzRRVUZCUlhkRVVWbEtTMjlhU1Fwb2RtTk9RVkZGVEVKUlFVUm5aMFZDUVVscVkxRlNhbWRxV1M5a1pWVjVMMHQ0TmtoclNtaERWbXBKU3pWak1HWlJWQzlGVGpkMGRIZFVTa1JCWkhCUUNqQnlXSFJNVlN0WWExVTBXa3Q0Y0Znck0zcHNVbEZPYzNkTlFVb3lNRUkxWlZKU1MxTjFRa1pNVkhWSlZTczVTMlY2TVhSSmQxZGlXbFZ1UjBWU2FtRUtkeloxTURobFNEZGlZV0pRVVZSbFQwb3JNV1pOVWxrMlVFMVJXRzFwVFhWNFoyUTJSWFl3VTFGVFVtbHVhSFJGVkV3MVRXeEZkM2xWV0VWSFV6SXhRZ3BVZEc0eGFWSlhWVzlpZEdzM01VVnRiME42WlhWUUwxQllkV1ZXYmt4NGJreDFUM0Y0UVhSalJreHBhR2MxVEUxVGFtbFdabTB6ZVhWc2RHcFdRV0pvQ2taeFdGZENjbFUwWWtseGNWRmhibVIxTlRSMWVUZFpORUptVTFOSlUxSjNUazFLUnpjMlUwSnVkelJPV1ZFMWNqVjNSM0F6UTBOeWEycHVhR1V5WjNJS1pXdGhNamxGVlZBM1R6Z3pSM1UwYTNsRVMxZFpLMUo1VWt0clNGaEdWV3ByVjI5bWJUVk5QUW90TFMwdExVVk9SQ0JEUlZKVVNVWkpRMEZVUlMwdExTMHRDZz09CiAgICAgIGNsaWVudC1rZXktZGF0YTogTFMwdExTMUNSVWRKVGlCU1UwRWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRcE5TVWxGY0ZGSlFrRkJTME5CVVVWQmRDODVLekZLTlZoRlUydDBPRll4TkhwaGVrVktkSGh3VWtGTVpWZDZlazFwTlZwV1MzbFZhRlJoYWxsV1NXNVFDbm96S3pWRVRXaDRjMXBaU2tkVmVsZ3ZNMUZwTDFrMlZuUk9VVFYxT0RCc1dFWjVUV3h1VDBsWlYyUklVRk52WmtwUVlXTXpaR2RzYW5oSE5HWmtWMnNLYmswdmNUSmxTMFZ2Vkdsa1pHb3hkMHRvZDFka1NtMXpRWFJKZDBGMlp6aENjM1ZVV2tWc1YySldOVVE1TWxoNVYwbEZZbmgxVVdKWWFWQnNibHBFS3dwUU4xQnVObWxET0UxbmNGaGFSVmxIVTBKTmNYRjNkRlU1ZG5RdksweHljMlkzVWxadWRHZzNNVEJUTjIxRk1tSk1NMFZpTVc4eFlVTXhTRWh0V0RGRkNqaFNVMmcyYVhaeVNraHZhbmwyUVRJNVpuTlhNVXhVZVM5SlRGTjZPR3QwVW1FdlVFaG5iRGxaTDB4MlNtcFRhMmh5ZGxnMEwzWkVSbkl3UkdsaGVtZ0tPVU54SzFCcVNFaDFObWt2WW1GclNHMTBjRzR4UWpSQ1IzVkhUbFpsT0haT1VsZDJXRkZKUkVGUlFVSkJiMGxDUVZGRGFGVkRWbmMwVUZWNVpsZHFhZ3BGU0VSc01sRTRUR2gyWm1aQllXcFRWWEZhT1hoeGIyRnliVE5hVDFOMVdWTnJOV1lyTDJ4UU5VeG5VVEp3Y0ZacVVrcGtlWGROVjFNMWFXbDBaVVkzQ2pkbGNGRmFSemsxVWtGalVWcHJlVVp4YkZWMGQyVjRZbUp5U0ZoRlpFVjFkVlY1Wkd0dlpYbDVTelZCTjI1TVYyaENlUzlRYlhKT2FGTkVVMUpHWVVZS1l5ODJhMk51ZUdoVmR6WnllV2hhUzFsNE1uRlVSamNyTmpKUE0wUnpUVU5zU2xsUVkwTmpjMHRsVG1kTFdtdFhka3BhYm1wSWNsaEhOVTA1WkV4bmVRcHdUVXhVUjFOWk9HSkhXREpxTkVrME5TdEVURlZNVTJJd09EbHdNVk12ZFZKRlRtaEhVRloxVlc5WmJWbG5OVTlWTjBvMVZIcFZSazlKSzJGdlRtTk5DbG92Y25Od2VIUllabUUzVldoNldFMUdiMjV5Y0RORVp6ZzVWME5JWlhrdmJVdGhObU15SzA1clVXb3lVRlJ1T1dkWlJVZFBOa1I1SzFwSFVHTkNWazRLTUU5NlNsaE9iVGxCYjBkQ1FVNU9XazVhZDBaaFZUUjRSR1JRYlZZMGFrMHhkMHR6YkhsNmNTczRabXhLWmk5ME15dG5WVFIxYkVsdFpqRTJNVTlWTlFwUE9HNVRUSFZMZDJaT1FYQm5WWEJXYldGWE0zTmpZMUJIWjFsSVVWVlZSM1p1ZUVaSGFFVmxXRkpKZWpjNVMyYzJaMnROVXpJM2NVWnJTSEJEUTIxNkNrUm1OSE5aVmt0MlpqWjVVbWQwYzNac04xbFZWRGhLTjJaelV6ZDBOVFIwVmxwM2JuRXphMkozUlU5VlZFOXJPRFZ3YjFOb1YwSlVRVzlIUWtGT04yWUtRMVExWTFjelZWaDNlRWs1Vm5GalZVbEljMUZPWXl0UksxSXlNRkUxYzNRMVRrVTFXVUoyTldwekszZENNbTl1WlZNeVVYbzJWbE5WU21kdFpFRnBMd3BUZEhsM01ITnVTa1YzV2t0VWJtRkVlSE56YlZOSVNrNDNhWGRHTVV4Mk1uVkJTR1owYVdJd2REWjVWMDFIVm1sSlUwNXZkM1JpVlVGSlVsVjJja1ZVQ2xoNk5HcEhUaTh5WW5ock5rbFZXbkZrU0ZkaE4zSlRaMkZVZFhkRmJXTTRZa00zUmpNemRWQkJiMGRDUVVsRGNXWk5TMmhaVEhscWFrbEhSMW8xTHpJS05VdGlVMGcyTjA4eE56SlpUMWwzV0dGM2NrWlFSMk01VG1SS2JGcDRjWFIyTUVwak0xRktVVFEwZEhVeVZFWkNOelp2T1hKT1RUZ3hSMFEzU21Kak5ncEtaR3hPTUVaTEwyOHpWMnBtVFhSRUx6TmlSM0l4TWpBd1VuZE1TRVpqVjJ4T2R6WmtTREU0VEd0UlIzbG9NV0ZYWjJkV1ZWbEdZVFJhUVhadU9XVkRDbFJsTkd4RlNGWkpaV05KY1d4TVFXaDZWbTVpUlV0MlZrRnZSMEpCU3poVU9FeFFMMWswTUhoa1NHeDNia0pETWxjcmJYZDVNRlJoWTNkbmJHOTJTbFlLWkVOdWVqZzBPRzFXVlhwTU1FcGtVVzFRTXpGbk1XdDNkRGhWSzJRcmNXcE5NVVEwZVhrelpTdHJXRE4xTTIxWlpsZE1OMGRRUWt0VVpUVm9VMnRQTmdwU1kxTmlSa0ZITkZCck1ta3dhbEJwYVZoMlEyZFZVek15UVhkalkyOTVlVlpwUWlzck4zZzRXRGQzYld0U2N6WTFNaXN6YmxGMGFEbERhME5aVVV0bENsVmlTRkZ0V1ZnM1FXOUhRVWx0TjI5bmRqQndNRmxVUmswd2FXcG1hbXR4VVhOVWNuUmxVblpxY1UxRU1saFBVbkY1UzNWT1RFWTViMnRXVTIxMk16Z0tjeTl4UTNKb1REQllaRk42UWtnemFXb3hjbmd3YmpSRFZFRjRSalpqTTBOblkzRlFMM0ZSZWtSUFpFVjZZWE42V2tKUVEyaE1jbGREWWtSSlRuZFZad3BvTjA1bmVISjRTa05tSzJORldXTnVjWHBaUlhVcllXRldXa1kxYjBSUlZGRmxVVTgyWTBOTE9FMUVibUZ1ZUhGMVIwNXhWaXRqUFFvdExTMHRMVVZPUkNCU1UwRWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRbz0KICAgIG5hbWU6IGthcm1hZGEtYXBpc2VydmVyCmNvbnRleHRzOgogIC0gY29udGV4dDoKICAgICAgY2x1c3Rlcjoga2FybWFkYS1hcGlzZXJ2ZXIKICAgICAgdXNlcjoga2FybWFkYS1hcGlzZXJ2ZXIKICAgIG5hbWU6IGthcm1hZGEtYXBpc2VydmVyCmN1cnJlbnQtY29udGV4dDoga2FybWFkYS1hcGlzZXJ2ZXI=")

	type args struct {
		kubeconfigPath  string
		secretName      string
		secretNamespace string
		k8sClient       *testclient.Clientset
	}

	tests := []struct {
		name    string
		secret  *v1.Secret
		args    args
		want    string
		wantErr bool
	}{
		{
			name: "write karmadaConfig",
			secret: &v1.Secret{
				ObjectMeta: metav1.ObjectMeta{
					Namespace: "karmada-system",
					Name:      "karmada-kubeconfig",
				},
				Data: map[string][]byte{"kubeconfig": byteSline},
			},
			args: args{
				kubeconfigPath:  "/tmp/karmadaConfig",
				secretName:      "karmada-kubeconfig",
				secretNamespace: "karmada-system",
				k8sClient:       testclient.NewSimpleClientset(),
			},
			want:    "/tmp/karmadaConfig",
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			tt.args.k8sClient.CoreV1().Secrets(tt.args.secretNamespace).Create(context.TODO(), tt.secret, metav1.CreateOptions{})
			got, err := WriteKubeconfig(tt.args.kubeconfigPath, tt.args.secretName, tt.args.secretNamespace, tt.args.k8sClient)
			if (err != nil) != tt.wantErr {
				t.Errorf("WriteKubeconfig() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			if got != tt.want {
				t.Errorf("WriteKubeconfig() = %v, want %v", got, tt.want)
			}
		})
	}
}
